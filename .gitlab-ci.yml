image: marioarduini/rumble-source:2020-11-23

stages:
  - build
  - spark-tests
  - other-tests

Build:
  stage: build
  artifacts:
    paths:
      - target/
  script:
    - ant -buildfile build_antlr_parser.xml generate-parser -Dantlr.jar=lib/antlr-4.9.3-complete.jar
    - mvn clean compile assembly:single

SparkRuntimeTest:
  stage: spark-tests
  script:
    - mvn -Dtest=SparkRuntimeTests test  -Dmaven.test.redirectTestOutputToFile=true
  artifacts:
    when: always
    paths:
      - target/TEST-iq.SparkRuntimeTests.xml
    reports:
      junit: target/TEST-iq.SparkRuntimeTests.xml